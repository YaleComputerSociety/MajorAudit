!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).UniversalCookie=t()}(this,(function(){"use strict";
/*!
   * cookie
   * Copyright(c) 2012-2014 Roman Shtylman
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   */var e=function(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");var i={},o=(t||{}).decode||n,s=0;for(;s<e.length;){var a=e.indexOf("=",s);if(-1===a)break;var c=e.indexOf(";",s);if(-1===c)c=e.length;else if(c<a){s=e.lastIndexOf(";",a-1)+1;continue}var h=e.slice(s,a).trim();if(void 0===i[h]){var d=e.slice(a+1,c).trim();34===d.charCodeAt(0)&&(d=d.slice(1,-1)),i[h]=r(d,o)}s=c+1}return i},t=function(e,t,n){var r=n||{},a=r.encode||s;if("function"!=typeof a)throw new TypeError("option encode is invalid");if(!o.test(e))throw new TypeError("argument name is invalid");var c=a(t);if(c&&!o.test(c))throw new TypeError("argument val is invalid");var h=e+"="+c;if(null!=r.maxAge){var d=r.maxAge-0;if(isNaN(d)||!isFinite(d))throw new TypeError("option maxAge is invalid");h+="; Max-Age="+Math.floor(d)}if(r.domain){if(!o.test(r.domain))throw new TypeError("option domain is invalid");h+="; Domain="+r.domain}if(r.path){if(!o.test(r.path))throw new TypeError("option path is invalid");h+="; Path="+r.path}if(r.expires){var f=r.expires;if(!function(e){return"[object Date]"===i.call(e)||e instanceof Date}(f)||isNaN(f.valueOf()))throw new TypeError("option expires is invalid");h+="; Expires="+f.toUTCString()}r.httpOnly&&(h+="; HttpOnly");r.secure&&(h+="; Secure");r.partitioned&&(h+="; Partitioned");if(r.priority){switch("string"==typeof r.priority?r.priority.toLowerCase():r.priority){case"low":h+="; Priority=Low";break;case"medium":h+="; Priority=Medium";break;case"high":h+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(r.sameSite){switch("string"==typeof r.sameSite?r.sameSite.toLowerCase():r.sameSite){case!0:h+="; SameSite=Strict";break;case"lax":h+="; SameSite=Lax";break;case"strict":h+="; SameSite=Strict";break;case"none":h+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return h},i=Object.prototype.toString,o=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function n(e){return-1!==e.indexOf("%")?decodeURIComponent(e):e}function s(e){return encodeURIComponent(e)}function r(e,t){try{return t(e)}catch(t){return e}}function a(e,t={}){const i=function(e){if(e&&"j"===e[0]&&":"===e[1])return e.substr(2);return e}(e);if(!t.doNotParse)try{return JSON.parse(i)}catch(e){}return e}return class{constructor(t,i={}){this.changeListeners=[],this.HAS_DOCUMENT_COOKIE=!1,this.update=()=>{if(!this.HAS_DOCUMENT_COOKIE)return;const t=this.cookies;this.cookies=e(document.cookie),this._checkChanges(t)};const o="undefined"==typeof document?"":document.cookie;this.cookies=function(t){return"string"==typeof t?e(t):"object"==typeof t&&null!==t?t:{}}(t||o),this.defaultSetOptions=i,this.HAS_DOCUMENT_COOKIE=function(){const e="undefined"==typeof global?void 0:global.TEST_HAS_DOCUMENT_COOKIE;return"boolean"==typeof e?e:"object"==typeof document&&"string"==typeof document.cookie}()}_emitChange(e){for(let t=0;t<this.changeListeners.length;++t)this.changeListeners[t](e)}_checkChanges(e){new Set(Object.keys(e).concat(Object.keys(this.cookies))).forEach((t=>{e[t]!==this.cookies[t]&&this._emitChange({name:t,value:a(this.cookies[t])})}))}_startPolling(){this.pollingInterval=setInterval(this.update,300)}_stopPolling(){this.pollingInterval&&clearInterval(this.pollingInterval)}get(e,t={}){return t.doNotUpdate||this.update(),a(this.cookies[e],t)}getAll(e={}){e.doNotUpdate||this.update();const t={};for(let i in this.cookies)t[i]=a(this.cookies[i],e);return t}set(e,i,o){o=o?Object.assign(Object.assign({},this.defaultSetOptions),o):this.defaultSetOptions;const n="string"==typeof i?i:JSON.stringify(i);this.cookies=Object.assign(Object.assign({},this.cookies),{[e]:n}),this.HAS_DOCUMENT_COOKIE&&(document.cookie=t(e,n,o)),this._emitChange({name:e,value:i,options:o})}remove(e,i){const o=i=Object.assign(Object.assign(Object.assign({},this.defaultSetOptions),i),{expires:new Date(1970,1,1,0,0,1),maxAge:0});this.cookies=Object.assign({},this.cookies),delete this.cookies[e],this.HAS_DOCUMENT_COOKIE&&(document.cookie=t(e,"",o)),this._emitChange({name:e,value:void 0,options:i})}addChangeListener(e){this.changeListeners.push(e),this.HAS_DOCUMENT_COOKIE&&1===this.changeListeners.length&&("object"==typeof window&&"cookieStore"in window?window.cookieStore.addEventListener("change",this.update):this._startPolling())}removeChangeListener(e){const t=this.changeListeners.indexOf(e);t>=0&&this.changeListeners.splice(t,1),this.HAS_DOCUMENT_COOKIE&&0===this.changeListeners.length&&("object"==typeof window&&"cookieStore"in window?window.cookieStore.removeEventListener("change",this.update):this._stopPolling())}}}));
